<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bindu Agent</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a1a1a',
                        secondary: '#6b7280',
                        accent: '#10b981',
                        'bg-primary': '#fafafa',
                        'bg-secondary': '#ffffff',
                        'border-primary': '#e5e7eb',
                        'border-secondary': '#e0e0e0',
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- Custom CSS for animations and special cases -->
    <link rel="stylesheet" href="/static/styles/custom.css">
</head>
<body class="font-mono bg-bg-primary h-screen text-primary text-sm overflow-hidden">
    <div class="w-full h-screen flex flex-col overflow-hidden">
        <!-- Header -->
        <div class="bg-white border-b border-border-primary px-8 py-6 min-h-[120px] flex items-center justify-between flex-shrink-0 shadow-sm">
            <div class="flex flex-col gap-2">
                <div class="flex items-center gap-3">
                    <h1 id="agent-name-header" class="font-mono text-3xl font-bold text-gray-900 tracking-tight">Loading...</h1>
                    <span class="w-2 h-2 bg-accent rounded-full animate-pulse-green"></span>
                    <span class="font-mono text-xs font-medium text-accent uppercase tracking-wider">Online</span>
                </div>
                <p id="agent-subtitle" class="font-mono text-sm text-secondary leading-relaxed">Loading...</p>
                <div id="agent-metadata" class="flex gap-2 flex-wrap">
                    <span class="font-mono text-[10px] font-medium text-secondary bg-gray-100 px-2.5 py-1 rounded-md border border-border-primary tracking-wide">v1.0.0</span>
                    <span class="font-mono text-[10px] font-medium text-secondary bg-gray-100 px-2.5 py-1 rounded-md border border-border-primary tracking-wide">localhost</span>
                    <span id="paywall-badge" class="font-mono text-[10px] font-semibold bg-gradient-to-r from-yellow-100 to-yellow-200 border border-yellow-400 text-yellow-900 px-2.5 py-1 rounded-md hidden">üí∞ Behind Paywall</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="openAuthSettings()" title="Set JWT Token" class="px-4 py-2 bg-white border border-gray-300 rounded-md font-mono text-xs font-medium text-gray-700 cursor-pointer transition-all hover:bg-gray-50 hover:border-gray-400 hover:text-gray-900">Token</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex bg-white border-b border-border-secondary px-6 h-12 flex-shrink-0">
            <button onclick="switchTab('agent-info')" class="tab px-5 py-3 cursor-pointer border-none bg-transparent font-mono text-sm font-medium text-gray-600 border-b-2 border-transparent transition-all hover:text-primary hover:bg-gray-50">Agent Info</button>
            <button onclick="switchTab('chat')" class="tab active px-5 py-3 cursor-pointer border-none bg-transparent font-mono text-sm font-medium text-primary border-b-2 border-primary transition-all">Chat</button>
        </div>

        <!-- Tab Content -->
        <div class="flex-1 flex flex-col overflow-hidden min-h-0">
            <!-- Agent Info Tab -->
            <div id="agent-info" class="tab-content hidden flex-1 overflow-hidden min-h-0">
                <div class="flex-1 grid grid-cols-[340px_1fr] gap-0 overflow-hidden min-h-0 bg-bg-primary">
                    <!-- Left Column - Sidebar with collapsible sections -->
                    <div class="flex flex-col border-r border-border-primary overflow-y-auto bg-white p-0">
                        <!-- Agent Overview Card -->
                        <div class="border-b border-border-primary">
                            <div onclick="toggleSection('overview')" class="section-header px-4 py-3 cursor-pointer flex justify-between items-center bg-white transition-all hover:bg-gray-50 select-none">
                                <h3 class="font-mono text-xs font-semibold text-gray-900 m-0">Agent Overview</h3>
                                <span class="toggle-icon text-[9px] text-gray-400 transition-transform duration-300">‚ñº</span>
                            </div>
                            <div id="overview-content" class="section-content expanded max-h-0 overflow-hidden transition-all duration-300 bg-white">
                                <div id="agent-card-content" class="text-gray-400 text-xs text-center p-3">Loading agent information...</div>
                            </div>
                        </div>

                        <!-- DID Identity Card -->
                        <div class="border-b border-border-primary">
                            <div onclick="toggleSection('did')" class="section-header px-4 py-3 cursor-pointer flex justify-between items-center bg-white transition-all hover:bg-gray-50 select-none">
                                <h3 class="font-mono text-xs font-semibold text-gray-900 m-0">DID Identity</h3>
                                <span class="toggle-icon text-[9px] text-gray-400 transition-transform duration-300">‚ñº</span>
                            </div>
                            <div id="did-content" class="section-content expanded max-h-0 overflow-hidden transition-all duration-300 bg-white">
                                <div id="did-summary-content" class="text-gray-400 text-xs text-center p-3">Loading DID...</div>
                            </div>
                        </div>

                        <!-- Skills Card -->
                        <div class="border-b border-border-primary">
                            <div onclick="toggleSection('skills')" class="section-header px-4 py-3 cursor-pointer flex justify-between items-center bg-white transition-all hover:bg-gray-50 select-none">
                                <h3 class="font-mono text-xs font-semibold text-gray-900 m-0">Skills</h3>
                                <span class="toggle-icon text-[9px] text-gray-400 transition-transform duration-300">‚ñº</span>
                            </div>
                            <div id="skills-content" class="section-content expanded max-h-0 overflow-hidden transition-all duration-300 bg-white">
                                <div id="skills-summary-content" class="text-gray-400 text-xs text-center p-3">Loading skills...</div>
                            </div>
                        </div>

                    </div>

                    <!-- Right Column - Agent Card JSON -->
                    <div class="flex flex-col overflow-hidden bg-bg-primary">
                        <div class="flex-1 flex flex-col overflow-hidden m-6 bg-white border border-border-primary rounded-lg shadow-sm">
                            <div class="px-6 py-4 border-b border-border-primary flex justify-between items-center bg-white">
                                <h3 class="font-mono text-sm font-semibold text-gray-900 m-0">Agent Card (JSON)</h3>
                                <button onclick="copyAgentCardJSON()" class="px-3 py-2 bg-white border border-gray-300 rounded-md font-mono text-xs font-medium text-secondary cursor-pointer transition-all hover:bg-blue-500 hover:text-white hover:border-blue-500">üìã Copy JSON</button>
                            </div>
                            <div class="flex-1 overflow-auto p-6 bg-gray-50">
                                <pre id="agent-json-display" class="m-0 font-mono text-[10px] leading-relaxed text-primary whitespace-pre-wrap break-words">Loading...</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chat" class="tab-content active flex flex-col flex-1 overflow-hidden min-h-0">
                <div class="flex-1 grid grid-cols-[280px_1fr] gap-0 overflow-hidden min-h-0">
                    <!-- Context Sidebar -->
                    <div class="flex flex-col bg-white border-r border-border-secondary overflow-hidden">
                        <div class="px-4 py-4 border-b border-border-secondary flex justify-between items-center bg-white flex-shrink-0">
                            <h3 class="font-mono text-sm font-semibold text-gray-900 m-0">Contexts</h3>
                            <button onclick="createNewContext()" class="px-3 py-2 bg-primary text-white border-none rounded font-mono text-xs font-medium cursor-pointer transition-all hover:bg-black">+ New</button>
                        </div>
                        <div id="context-list" class="flex-1 overflow-y-auto p-3">
                            <div class="text-gray-400 text-xs text-center p-3">No contexts yet</div>
                        </div>
                    </div>

                    <!-- Chat Area -->
                    <div class="flex-1 flex flex-col bg-white relative min-w-0 overflow-hidden">
                        <div id="context-indicator" class="bg-gray-50 border-b border-border-secondary px-6 py-2 text-xs text-gray-600 font-mono flex items-center gap-2 flex-shrink-0 before:content-['‚óè'] before:text-[8px] before:text-green-500">
                            <span id="context-indicator-text">No active context</span>
                        </div>
                        <div id="chat-messages" class="flex-1 overflow-y-auto px-6 py-6 pb-32 bg-white min-h-0"></div>
                        <div class="absolute bottom-0 left-0 right-0 border-t border-border-secondary px-6 py-4 bg-white z-10 min-h-[80px] max-h-[200px]">
                            <div id="reply-indicator" class="reply-indicator bg-gray-100 border-l-4 border-primary px-3 py-2 mb-3 rounded text-xs hidden">
                                <span id="reply-text"></span>
                                <span onclick="clearReply()" class="reply-close cursor-pointer font-bold text-gray-600 ml-2">‚úï</span>
                            </div>
                            <div class="flex gap-2">
                                <input
                                    type="text"
                                    id="message-input"
                                    placeholder="Type your message..."
                                    onkeypress="handleKeyPress(event)"
                                    class="flex-1 px-4 py-3 border border-border-secondary rounded font-mono text-sm transition-colors focus:outline-none focus:border-primary"
                                >
                                <button onclick="sendMessage()" id="send-button" class="px-6 py-3 bg-primary text-white border-none rounded cursor-pointer font-mono text-sm font-medium transition-all hover:bg-black disabled:bg-gray-300 disabled:cursor-not-allowed">Send</button>
                            </div>
                        </div>
                        <div id="chat-error" class="hidden bg-red-50 text-red-600 px-3 py-2 rounded-md my-2 text-xs"></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="bg-white border-t border-border-secondary px-8 py-4 flex justify-between items-center flex-shrink-0 min-h-[60px]">
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 font-mono text-xs text-secondary">
                    <span class="w-1.5 h-1.5 bg-accent rounded-full"></span>
                    <span>Powered by Bindu üåª</span>
                </div>
                <span class="text-gray-300">|</span>
                <span class="text-gray-500 text-xs">We provide heart to your AI, so that it can talk, negotiate, and trade securely</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="https://bindus.directory" target="_blank" class="font-mono text-xs text-secondary no-underline transition-colors hover:text-primary">Directory</a>
                <a href="https://docs.getbindu.com/bindu" target="_blank" class="font-mono text-xs text-secondary no-underline transition-colors hover:text-primary">Docs</a>
                <a href="https://github.com/getbindu/Bindu" target="_blank" class="font-mono text-xs text-secondary no-underline transition-colors hover:text-primary">GitHub</a>
                <a href="https://news.getbindu.com" target="_blank" class="font-mono text-xs text-secondary no-underline transition-colors hover:text-primary">Newsletter</a>
                <div class="font-mono text-xs text-gray-400">
                    Built by <a href="https://getbindu.com" target="_blank" class="text-secondary no-underline transition-colors hover:text-primary">Bindus</a> in Amsterdam
                </div>
            </div>
        </div>
    </div>

    <!-- Skill Detail Modal -->
    <div id="skill-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[2000] items-center justify-center">
        <div class="bg-white rounded-lg w-[90%] max-w-[800px] max-h-[85vh] flex flex-col shadow-lg">
            <div class="px-6 py-5 border-b border-gray-200 flex justify-between items-center">
                <h2 id="skill-modal-title" class="text-lg font-semibold text-primary m-0">Skill Details</h2>
                <span onclick="closeSkillModal()" class="text-2xl text-gray-400 cursor-pointer leading-none transition-colors hover:text-primary">&times;</span>
            </div>
            <div id="skill-modal-body" class="px-6 py-6 overflow-y-auto flex-1">
                <div class="text-gray-400 text-xs text-center p-3">Loading skill details...</div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-[2000] items-center justify-center">
        <div class="bg-white rounded-lg w-[90%] max-w-[600px] max-h-[85vh] flex flex-col shadow-lg">
            <div class="px-6 py-5 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-primary m-0">Submit Task Feedback</h3>
                <span onclick="closeFeedbackModal()" class="text-2xl text-gray-400 cursor-pointer leading-none transition-colors hover:text-primary">&times;</span>
            </div>
            <div class="px-6 py-6 overflow-y-auto flex-1">
                <div class="mb-4">
                    <label class="block font-mono text-xs font-medium text-primary mb-2">Task ID:</label>
                    <div id="feedback-task-id" class="font-mono text-xs text-secondary bg-gray-50 px-2 py-2 rounded break-all"></div>
                </div>
                <div class="mb-4">
                    <label for="feedback-rating" class="block font-mono text-xs font-medium text-primary mb-2">Rating (1-5):</label>
                    <select id="feedback-rating" class="w-full px-3 py-2 border border-border-secondary rounded-md font-mono text-xs transition-colors focus:outline-none focus:border-primary">
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê Average</option>
                        <option value="2">‚≠ê‚≠ê Poor</option>
                        <option value="1">‚≠ê Very Poor</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="feedback-text" class="block font-mono text-xs font-medium text-primary mb-2">Feedback <span class="text-gray-500 font-normal">(optional)</span>:</label>
                    <textarea
                        id="feedback-text"
                        rows="4"
                        placeholder="Share your thoughts (optional)..."
                        class="w-full px-3 py-2 border border-border-secondary rounded-md font-mono text-xs transition-colors resize-y min-h-[100px] focus:outline-none focus:border-primary"
                    ></textarea>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeFeedbackModal()" class="px-6 py-3 bg-white text-primary border border-gray-300 rounded-md font-mono text-xs font-medium cursor-pointer transition-all hover:bg-gray-50 hover:border-gray-400">Cancel</button>
                <button onclick="submitFeedback()" class="px-6 py-3 bg-primary text-white border-none rounded-md font-mono text-xs font-medium cursor-pointer transition-all hover:bg-black">Submit Feedback</button>
            </div>
        </div>
    </div>

    <!-- Application Logic - ES6 Modules -->
    <script type="module" src="/static/js/index.js"></script>
</body>
</html>
